#!/usr/bin/env ruby

require "rubygems"
require "serialport"
require "thor"
require "logger"

require_relative "./coffin"

serial = SerialPort.new "/dev/cu.usbmodem14101", 9600
$driver = Coffin::Driver.new(serial, Logger.new(STDOUT))

sleep 3

class CoffinCLI < Thor
  DEFAULT_HOLD_TIME = 5

  %i(power volume_up volume_down usb).each do |button|
    option :holdtime
    desc "#{button} {press|hold} --holdtime=5", "#{button} button"

    define_method button do |action|
      case action
      when "press"
        $driver.press(button)
      when "hold"
        $driver.hold(button, Integer(options[:holdtime] || DEFAULT_HOLD_TIME))
      end
    end
  end



end

CoffinCLI.start(ARGV)
